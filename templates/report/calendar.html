{% extends "base.html" %}
{% block content %}

<script src="https://cdn.jsdelivr.net/npm/fullcalendar@5.10.1/main.min.js" integrity="sha256-XOMgUu4lWKSn8CFoJoBoGd9Q/OET+xrfGYSo+AKpFhE="
        crossorigin="anonymous">
</script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jqueryui/1.12.1/jquery-ui.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.18.1/moment.min.js"></script>
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/fullcalendar@5.10.1/main.min.css"
      integrity="sha256-16PDMvytZTH9heHu9KBPjzrFTaoner60bnABykjNiM0=" crossorigin="anonymous"
>
<script>
      document.addEventListener('DOMContentLoaded', function() {
        var calendarEl = document.getElementById('calendar');
        var calendar = new FullCalendar.Calendar(calendarEl, {
    initialView: 'dayGridMonth',
    events: [
    {% for event in events %}
        {
            title: "{{ event.title }}",
            start: '{{ event.start }}',
            end: '{{ event.end }}',
            id: '{{ event.id }}'
        },
    {% endfor %}
    ],
    selectable: true,
    editable: true,
    select: function(selectinfo) {
        var title = prompt("Enter Event Title");
        if (title) {
            var start = moment(selectinfo.start).format("Y-MM-DD");
            var end = moment(selectinfo.end).format("Y-MM-DD");
            console.log(end);
            $.ajax({
                type: "GET",
                url: '/calendar/add_event',
                data: {'title': title, 'start': start, 'end': end},
                dataType: "json",
                success: function (data) {
                calendar.refetchEvents();
                alert("Added Successfully");
                },
                failure: function (data) {
                alert('There is a problem!!!');
                }
            });
        }
    },
    eventDrop: function(eventDropInfo) {
        var delta = eventDropInfo.delta.days;
        var title = eventDropInfo.event._def.title;
        var id = eventDropInfo.event._def.publicId;
        $.ajax({
            type: "GET",
            url: '/calendar/drop_event',
            data: {'title': title, 'delta': delta, 'id': id},
            dataType: "json",
            success: function (data) {
                calendar.refetchEvents();
                alert('Event Drop');
            },
            failure: function (data) {
                alert('There is a problem!!!');
            }
        });
    },
    eventClick: function(eventClickInfo) {
        if (confirm("Are you sure you want to remove it?")) {
            var id = eventClickInfo.event._def.publicId;
            $.ajax({
                type: "GET",
                url: '/calendar/delete_event',
                data: {'id': id},
                dataType: "json",
                success: function (data) {
                    calendar.refetchEvents();
                    alert('Event Removed');
                },
                failure: function (data) {
                    alert('There is a problem!!!');
                }
            });
        }
    },
});
calendar.render();
});
</script>
<div class="container my-3">
    <div class="container">
        {% if is_outside_calendar_connected %}
        <div><a href="{{ outside_calendar_url }}" target="_blank">Outside Calendar</a></div>
        {% endif %}
        <div id="calendar"></div>
    </div>
</div>

{% endblock %}